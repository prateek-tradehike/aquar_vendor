require(['prototype','NEKLOvendor'], function(){!function(){var t={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll|keyup)$/,MouseEvents:/^(?:click|mouse(?:down|up|over|move|out))$/},e={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0};Event.simulate=function(i,n){var a,s=Object.extend(e,arguments[2]||{}),r=null;i=$(i);for(var o in t)if(t[o].test(n)){r=o;break}if(!r)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");return document.createEvent?(a=document.createEvent(r),"HTMLEvents"==r?a.initEvent(n,s.bubbles,s.cancelable):a.initMouseEvent(n,s.bubbles,s.cancelable,document.defaultView,s.button,s.pointerX,s.pointerY,s.pointerX,s.pointerY,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.button,i),i.dispatchEvent(a)):(s.clientX=s.pointerX,s.clientY=s.pointerY,a=Object.extend(document.createEventObject(),s),i.fireEvent("on"+n,a)),i},Element.addMethods?Element.addMethods({simulate:Event.simulate}):(jQuery,console.log("Invalid install"))}(),function(t,e){function i(t){this.options=t||{}}t.NEKLO=t.NEKLO||{},t.NEKLO.Connectors={},i.prototype={$getPage:function(t,e,i,n){var a=this;return new Ajax.Request(this.options.url+"?isAjax=true",{parameters:{page:t,form_key:this.options.form_key,count:e},onSuccess:function(t){var e=a.$parseResponse(t);return i&&"function"==typeof i?i(e):e},onFailure:function(t){return n&&"function"==typeof n?n(t):t}})},$parseResponse:function(t){return t.responseJSON},$save:function(t){return t}},t.NEKLO.Connectors.Magento2Connector=i}(window,jQuery),function(t){function e(){}t.NEKLO=t.NEKLO||{},e.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events=this._events||{},t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)},emit:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},e.mixin=function(t){for(var i=["on","off","emit"],n=0;n<i.length;n++)"function"==typeof t?t.prototype[i[n]]=e.prototype[i[n]]:t[i[n]]=e.prototype[i[n]];return t},t.NEKLO.SimpleEventEmitter=e}(window),function(t,e,i,n){function a(t,n,a,s){this.setups=t,this.parent=a;var r=e.createElement(t.selector),o=i.template(t.template)(n),d=new Image;return d.src=n.image,d.onload=s,d.onerror=s,r.className=t.className,r.style.width=t.width,r.style.marginBottom=t.margin,r.innerHTML=o,this.dataset=n,r.dataset.position=n.position,r.dataset.entity_id=n.entity_id,r.dataset.attached=!0===n.attached||"true"===n.attached,r.dataset.isDirty=!0===n.isDirty||"true"===n.isDirty,r.addEventListener("click",this.eventClick,!1),addEvent(r,"dragstart",this.eventDragStart),addEvent(r,"dragenter",this.eventDragEnter),addEvent(r,"dragover",this.eventDragOver),addEvent(r,"drop",this.eventDrop),addEvent(r,"dragend",this.eventDragEnd),r.$$instance=this,r.$$instance.getElement=function(){return r},r}function s(t){this.options=t,this.separatorElements=[],this.dragElement=null,this.page=1;var i=e.createElement(t.list.selector);return i.className=t.list.className,i.style.marginLeft=t.list.margin,i.style.width=t.grid.cols*(parseInt(t.item.width)+parseInt(t.item.margin))+"px",i.$$instance=this,i.$$instance.getListElement=function(){return i},i}function r(t){this.options=t;var i=t.uploadButton,n=e.createElement(i.selector);return n.className=i.className,n.innerHTML=i.label,n.$$instance=this,n.$$instance.getElement=function(){return n},n.addEventListener("click",this.uploadPage,!1),n}function o(t){t=t||{};var a=this;this.dataStoring=[],this.totalItems=t.totalItems,this.page=1,delete t.totalItems,this.options=i.merge(this.options,t);var d=+this.options.grid.cols*+this.options.grid.rows;return n(e).bind("myPageLoadedEvent",a.afterLoadPage),this.options.connector.$getPage(this.page,d,function(t){var i=a.options,d=i.targetDOM;if(!t.length)return o.createErrorElement(i);var l=new s(i),c=new r(i);l.$$instance.sorter=a,d.appendChild(l),d.parentNode.appendChild(c),l.$$instance.updateList(t,i.item),l.$$instance.addSeparators(),c.$$instance.updateState(a.page,a.totalItems),c.$$instance.updateWidth(l),d.$$instance=a,c.$$instance.onUploadPage=a.uploadPage.bind(a),a.onUploadedPage=function(t){l.$$instance.removeSeparators(),l.$$instance.updateList(t,i.item),l.$$instance.addSeparators(),c.$$instance.updateState(a.page,a.totalItems),n(e).trigger("myPageLoadedEvent",[a])},l.$$instance.onListUpdated=a.updateDataStoring.bind(a),n(e).trigger("myPageLoadedEvent",[a])},function(e){o.createErrorElement(t,e)}),this}t.NEKLO=t.NEKLO||{},a.prototype={getParentInstance:function(){return this.getElement().$$instance.parent.$$instance},isAttached:function(){return"true"===this.getElement().dataset.attached},searchElementSibling:function(t,e){if(t)return"true"!==t.dataset.attached&&t.classList.contains(this.setups.className)?t:"next"===e?this.searchElementSibling(t.nextSibling,e):this.searchElementSibling(t.previousSibling,e)},updateElementState:function(t,e){var i=this.getElement(),n=this.setups.states;i.style.height=e+"px",i.dataset.position=t.position,i.dataset.entity_id=t.entity_id,i.dataset.attached=!0===t.attached||"true"===t.attached,i.dataset.isDirty=!0===t.isDirty||"true"===t.isDirty,!0===t.attached||"true"===t.attached?(i.classList.add(n.attached),i.setAttribute("draggable",!1)):(i.classList.remove(n.attached),i.setAttribute("draggable",!0));var a=this.searchElementSibling(i.previousSibling,"previous"),s=this.searchElementSibling(i.nextSibling,"next");a?i.classList.remove(n.disableLeft):i.classList.add(n.disableLeft),s?i.classList.remove(n.disableRight):i.classList.add(n.disableRight)},eventClick:function(t){t.preventDefault&&t.preventDefault();var e=t.target,i=e.getAttribute("btn")||e.parentNode.getAttribute("btn");return"attached"===i&&this.$$instance.handlerAttach.bind(this)(),"toLeft"===i&&this.$$instance.handlerToLeft.bind(this)(),"toBegin"===i&&this.$$instance.handlerToBegin.bind(this)(),"toRight"===i&&this.$$instance.handlerToRight.bind(this)(),"toEnd"===i&&this.$$instance.handlerToEnd.bind(this)(),"toPage"===i&&null===e.closest(".nd-list__item.attached")&&this.$$instance.handlerToPage.bind(this)(),"goToPage"===i&&this.$$instance.handlerGoToPage.bind(this)(),"input"!=e.tagName.toLowerCase()&&null===i&&this.$$instance.handlerToPageReset.bind(this)(),!1},eventDragStart:function(t){this.$$instance.getParentInstance().setDragElement(this),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/html",this.innerHTML),this.style.opacity="0.5"},eventDragOver:function(t){return t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect="move",!1},eventDragEnter:function(t){t.preventDefault&&t.preventDefault();var e=this.$$instance.getParentInstance(),i=e.getListElements(),n=this.$$instance.setups.states;return[].forEach.call(i,function(t){t.classList.remove(n.over)}),this.classList.add(n.over),!1},eventDrop:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation();var e=this.$$instance.getParentInstance(),i=e.getDragElement(),n=this;return this.$$instance.handlerMoving(i,n),!1},eventDragEnd:function(t){var e=this.$$instance.getParentInstance(),i=e.getListElements(),n=this.$$instance.setups.states;[].forEach.call(i,function(t){t.classList.remove(n.over)}),this.style.opacity="1"},handlerToLeft:function(){var t=this.$$instance.getParentInstance(),e=this.$$instance.searchElementSibling(this.previousSibling,"previous");if(e){var i=+e.dataset.position,n=+this.dataset.position;t.sortElements(i,n,this,!1)}},handlerToRight:function(){var t=this.$$instance.getParentInstance(),e=this.$$instance.searchElementSibling(this.nextSibling,"next");if(e){var i=+this.dataset.position,n=+e.dataset.position;t.sortElements(i,n,this,!0)}},handlerToBegin:function(){var t=this.$$instance.getParentInstance(),e=t.getListElements(),n=i.find(e,function(t){return t.dataset&&"false"==t.dataset.attached});if(n&&n!==this){var a=+n.dataset.position,s=+this.dataset.position;t.sortElements(a,s,this,!1)}},handlerToEnd:function(){var t=this.$$instance.getParentInstance(),e=i.slice(t.getListElements()).reverse(),n=i.find(e,function(t){return t.dataset&&"false"==t.dataset.attached});if(n&&n!==this){var a=+this.dataset.position,s=+n.dataset.position;t.sortElements(a,s,this,!0)}},handlerToPageReset:function(){return n(this).find(".to-page-frm").css({display:"none"}),n(this).find(".to-page-inp").prop("disabled",!0),!1},handlerGoToPage:function(t){var e=this;void 0==this.parent&&(t=this,e=t.$$instance);var a=n(t).find(".to-page-inp").val(),s=t.$$instance.getParentInstance(),r=s.sorter;if(""!==a&&(a=parseInt(a))>=1)if(r.page<a)r.pageSkip=!0,r.uploadPage(e.handlerGoToPage.bind(t));else{r.pageSkip=!1;var o=+r.options.grid.cols*+r.options.grid.rows*(a-1);o+=1;var d=i.toArray(s.getListElement().select(".nd-list__item")).slice(o),l=i.find(d,"dataset.attached","false");if(!l||l===this)return;var c=+l.dataset.position,p=+t.dataset.position,h=!1;c>p&&(o=c,c=p,p=o,h=!0);n(t).find(".to-page-frm").css({display:"none"});s.sortElements(c,p,t,h)}},handlerToPage:function(){var t=this,e=this.$$instance,i=t.$$instance.getParentInstance(),a=i.sorter,s=(a.totalItems/(+a.options.grid.cols*+a.options.grid.rows)).ceil();if(1==s)return void alert("No page to move to");var r=n(this).find(".to-page-frm");if(!n(this).attr("my-initialized")){var o=n(this).find(".to-page-inp");o.click(function(t){return t.preventDefault(),!1}),o.length&&e.addPageOptions(o,s),n(this).attr("my-initialized",!0)}n(this).find(".to-page-inp").prop("disabled",!1),r.css({display:"block"})},addPageOptions:function(t,e,i){for(var n=1;n<=e;n++)t.append('<option value="'+n+'"'+(i===n?' selected="selected"':"")+">"+n+"</option>")},handlerMoving:function(t,e){if(t==e||e.$$instance.isAttached())return!1;var i,n,a,s=t.$$instance.getParentInstance();+t.dataset.position>+e.dataset.position?(i=+e.dataset.position,n=+t.dataset.position,a=!1):(i=+t.dataset.position,n=+e.dataset.position,a=!0),s.sortElements(i,n,t,a)},handlerAttach:function(){var t=this.$$instance.getParentInstance();this.dataset.isDirty=!0,this.dataset.attached="true"!==this.dataset.attached&&!0!==this.dataset.attached,t.updateElementsState(),t.onListUpdated([this])}},t.NEKLO.SorterElement=a,s.prototype={getOptions:function(){return this.options},getListElements:function(){return this.getListElement().childNodes},getDragElement:function(){return this.dragElement},setDragElement:function(t){this.dragElement=t},addSeparators:function(){for(var t=this.getOptions(),n=t.separator,a=this.getListElements(),s=this.getListElement(),r=a.length,o=t.grid.cols*t.grid.rows,d=[],l=n.template,c=0;c<r;c++)c%o!=0&&0!==c||d.push(a[c]);i.forEach(d,function(t,a){a++;var r=e.createElement(n.selector);r.className=n.className,r.innerHTML=i.template(l)({value:a}),s.insertBefore(r,t),s.$$instance.separatorElements.push(r)})},removeSeparators:function(){var t=this.getListElement();i.forEach(t.$$instance.separatorElements,function(e){t.removeChild(e)}),t.$$instance.separatorElements=[]},sortElements:function(t,e,n,a){var s=this,r=t-1,o=e-1;this.removeSeparators();var d,l=this.getListElements();l=i.slice(l,r,o+1);var c=i.clone(l,!0);a?(d=e,l=l.reverse()):d=t,l=this.sortElementsByOrder(l,n,d),s.sortElementsInDOM(l,c),s.updateElementsState(),s.addSeparators(),s.onListUpdated(l)},sortElementsByOrder:function(t,e,n){var a;return i.forEach(t,function(t){t.$$instance.isAttached()||(t.dataset.isDirty=!0,a&&(a.dataset.position=t.dataset.position),a=t,t.dataset.entity_id===e.dataset.entity_id&&(t.dataset.position=n))}),t.sort(function(t,e){return+t.dataset.position-+e.dataset.position}),t},sortElementsInDOM:function(t,n){var a=this.getListElement(),s=e.createElement("li");a.insertBefore(s,n[0]),i.forEach(n,function(t){a.removeChild(t)}),i.forEach(t,function(t){a.insertBefore(t,s)}),a.removeChild(s)},updateList:function(t,e){if(!t||!Array.isArray(t))throw new Error("You can update list of elements with pass data like array");if(t.length){return this.createListItems(t,e)}},createListItems:function(t,e){function i(){++d===r&&n.updateElementsState()}var n=this,s=0,r=t.length,o=this.getListElement(),d=0;for(s;s<r;s++){var l=new a(e,t[s],o,i);o.appendChild(l)}return o},updateElementsState:function(){var t=this.getOptions().separator,e=this.getListElements(),n=0;i.forEach(e,function(t){t.clientHeight>n&&(n=t.clientHeight)}),i.forEach(e,function(e){e.classList.contains(t.className)||e.$$instance.updateElementState(e.dataset,n)})}},t.NEKLO.SorterList=s,r.prototype={uploadPage:function(t){t.preventDefault(),this.$$instance.onUploadPage()},updateState:function(t,e){var i=this.options,n=i.grid.cols;t*i.grid.rows*n>=e&&(this.getElement().style.display="none")},updateWidth:function(t){this.getElement()}},o.createErrorElement=function(t,i){var n=t.targetDOM,a=t.error,s=e.createElement(a.selector);s.className=a.className,s.innerHTML=i||a.message,n.appendChild(s)},o.EVENTS={ON_ITEMS_CHANGED:"ProductSorter:ON_ITEMS_CHANGED"},o.prototype={EVENTS:o.EVENTS,options:{targetDOM:e.querySelector("body"),grid:{cols:5,rows:2},uploadButton:{label:"Upload Next Page",className:"nd-btn upload",selector:"button"},error:{className:"nd-list__error",selector:"div",message:"Empty data"},list:{className:"nd-list",selector:"ul"},item:{className:"nd-list__item",selector:"li",width:"166px",margin:"20px",template:"<span>Say Hello</span>",states:{attached:"attached",disableLeft:"disableLeft",disableRight:"disableRight",over:"over"}},separator:{className:"nd-list__separator",selector:"li",template:""}},getDataStoring:function(){return this.dataStoring},updateDataStoring:function(t){var e=this.getDataStoring(),n=[];i.forEach(t,function(t){if("true"===t.dataset.isDirty){var a=t.dataset,s=i.find(e,"entity_id",a.entity_id);s?s=a:e.push(a),n.push(a)}}),this.emit&&this.emit(this.EVENTS.ON_ITEMS_CHANGED,n)},uploadPage:function(t){var e=this,i=this.options,n=i.grid.cols,a=i.grid.rows,s=+n*+a;i.connector.$getPage(++this.page,s,function(i){e.onUploadedPage(i),t&&t()})},doSave:function(){var t=this.getDataStoring();return this.options.connector.$save(t)},afterLoadPage:function(t,e){}},t.NEKLO.ProductSorter=t.NEKLO.SimpleEventEmitter?t.NEKLO.SimpleEventEmitter.mixin(o):t.NEKLO.ProductSorter}(window,document,_,jQuery),function(t,e,i){t.NEKLO=t.NEKLO||{};var n=Class.create();n.prototype=Object.assign(Object.create(t.NEKLO.SorterElement.prototype),{initialize:function(e,i,n,a){this.el=t.NEKLO.SorterElement.call(this,e,i,n,a)},searchElementSibling:function(t,e){if(t)return"true"!==t.dataset.attached&&t.classList.contains(this.setups.className)?t:"next"===e?this.searchElementSibling(t.nextSibling,e):this.searchElementSibling(t.previousSibling,e)},handlerGoToPage:function(t){void 0==this.parent&&(t=this,t.$$instance);var e=jQuery(t).find(".to-page-inp")[0].value;if(e=parseInt(e)){var i=t.$$instance.getParentInstance(),n=i.sorter;n.page;var a=(n.totalItems/n.getPageSize()).ceil(),s=[],r=function(){if(s.length&&s.pop(),0==s.length){var a=n.getPageSize()*(e-1);a+=1;var r,o,d,l=null;+t.dataset.position>a?(r=a,o=+t.dataset.position,d=!1):(r=+t.dataset.position,o=a,d=!0),jQuery(t).find(".to-page-frm")[0].setStyle({display:"none"}),l=i.sortData(r,o,t,d),i.onListUpdated(l),n.emit&&n.emit(n.EVENTS.ON_ITEMS_CHANGED,l),i.page=e,i.updateList(n.getItemData(e),e,n.options.item),n.pager.updateState(e,n.totalItems)}};e>=1&&(e>1&&n.loadedPages.indexOf(e-1)<0&&(s.push(1),n.uploadData(e-1,r.bind(this))),e<a&&n.loadedPages.indexOf(e+1)<0&&(s.push(1),n.uploadData(e+1,r.bind(this))),n.loadedPages.indexOf(e)<0?(s.push(1),n.uploadData(e,r.bind(this))):r())}}});var a=Class.create();a.prototype=Object.assign(Object.create(t.NEKLO.SorterList.prototype),{initialize:function(e){this.el=t.NEKLO.SorterList.call(this,e)},sortDataByOrder:function(t,e,n){var a,s=!1;return i.forEach(t,function(t,i){1!==t.attached&&!0!==t.attached&&"true"!==t.attached&&(!1===s&&(s=i),t.isDirty=!0,a&&(a.position=t.position),a=t,t.entity_id===e.dataset.entity_id&&(t.position=n+(isNaN(s)?0:s)))}),t.sort(function(t,e){return+t.position-+e.position}),t},sortData:function(t,e,n,a){var s,r=t-1,o=e-1,d=this.sorter,l=d.pageItemsStorge;l=i.slice(l,r,o+1);i.clone(l,!0);return a?(s=e,l=l.reverse()):s=t,l=this.sortDataByOrder(l,n,s)},sortElements:function(t,e,n,a){var s=this,r=t-1,o=e-1,d=this.sorter,l=(this.page-1)*d.getPageSize();r-=l,o-=l;var c,p=this.getListElements();p=i.slice(p,r,o+1);var h=i.clone(p,!0);a?(c=e,p=p.reverse()):c=t,p=this.sortElementsByOrder(p,n,c),s.sortElementsInDOM(p,h),s.updateElementsState(),s.onListUpdated(p)},updateList:function(e,i,n){this.page=i,this.updateSetups=n,t.NEKLO.SorterList.prototype.updateList.call(this,e,n)},createListItems:function(t,e){var i=this,a=0,s=t.length,r=this.getListElement();r.innerHTML="";var o=0,d=function(){++o===s&&i.updateElementsState()};for(a;a<s;a++)if(void 0!==t[a].name){var l=new n(e,t[a],r,d);r.appendChild(l.el)}return r},updateElementsState:function(){var t=this.getListElements(),e=0;i.forEach(t,function(t){t.clientHeight>e&&(e=t.clientHeight)}),i.forEach(t,function(t){t.$$instance.updateElementState(t.dataset,e)})}});var s=Class.create();s.prototype={initialize:function(t){this.options=t||{};var i=t.separator,n=i.template,a=e.createElement(i.selector);return a.className=i.className,a.innerHTML=n,this.pageTemplate=$("template-paging-item").innerHTML,a.$$instance=this,a.$$instance.getElement=function(){return jQuery(a)},this.el=a,a},updateState:function(t,e){var i,a=this.options.grid.cols*this.options.grid.rows;if(this.pagesCount=Math.ceil(e/a),this.page=t,!(t>this.pagesCount)){if(1==this.pagesCount)return void $$(".nd-list__separator")[0].hide();this._preparePages(t);var s=1*this.getElement().attr("initialized"),r=jQuery(this.getElement().find(".page-left")[0]);t>1?(r.removeClass("disabled"),s||addEvent(r,"click",this.updatePage.bind(this))):r.addClass("disabled"),s||addEvent(r,"click",this.updatePage.bind(this)),r=jQuery(this.getElement().find(".page-right")[0]),t<this.pagesCount?(r.removeClass("disabled"),s||addEvent(r,"click",this.updatePage.bind(this))):r.addClass("disabled"),i=jQuery(this.getElement().find(".page")[0]),s?(i.find("option").removeAttr("selected"),i.find('option[value="'+t+'"]').prop("selected","selected")):(n.prototype.addPageOptions(i,this.pagesCount,t),addEvent(i,"change",this.updatePage.bind(this))),i.val(t);var o=this.getElement().find(".total-pages")[0];o.innerHTML=o.innerHTML.replace("%s",this.pagesCount),o=this.getElement().find(".total-items")[0],o.innerHTML=o.innerHTML.replace("%d",e),this.getElement().attr("initialized",1)}},_preparePages:function(t){var e=this.getElement().find(".pager-holder")[0],n=this.pagesCount;e.innerHTML="";var a,s=t-1,r=t+1;r>n&&(r=n,s=n-2,s=s<1?1:s),s<=1&&(s=1,r=Math.min(3,n));var o;if(s<=3)for(o=1;o<s;o++)a=i.template(this.pageTemplate)({page:o}),e.insert(a),a=e.children[e.children.length-1],o==t?a.addClassName("active"):addEvent(a,"click",this.uploadPage.bind(this));else a=i.template(this.pageTemplate)({page:"1"}),e.insert(a),a=e.children[e.children.length-1],addEvent(a,"click",this.uploadPage.bind(this)),a=i.template(this.pageTemplate)({page:"..."}),e.insert(a),a=e.children[e.children.length-1],a.setStyle({cursor:"default"});for(o=s;o<=r;o++)a=i.template(this.pageTemplate)({page:o}),e.insert(a),a=e.children[e.children.length-1],o==t?a.addClassName("active"):addEvent(a,"click",this.uploadPage.bind(this));if(r>=n-2)for(o=r+1;o<=n;o++)a=i.template(this.pageTemplate)({page:o}),e.insert(a),a=e.children[e.children.length-1],addEvent(a,"click",this.uploadPage.bind(this));else a=i.template(this.pageTemplate)({page:"..."}),e.insert(a),a=e.children[e.children.length-1],a.setStyle({cursor:"default"}),a=i.template(this.pageTemplate)({page:n}),e.insert(a),a=e.children[e.children.length-1],addEvent(a,"click",this.uploadPage.bind(this))},updateWidth:function(t){this.prototype.updateWidth.call(this,t)},updatePage:function(t){var e=this.page;if("click"==t.type){t.preventDefault();var i=1*t.target.readAttribute("data-move");if(1==e&&i<0)return;if(e==this.pagesCount&&i>0)return;e+=i}else"change"==t.type?e=1*t.target.value:13==t.charCode&&(e=1*t.target.value);this.onUploadPage(e)},uploadPage:function(t){t.preventDefault();var e=1*jQuery(t.target).attr("data-page");isNaN(e)||this.onUploadPage(e)}};var r=Class.create();r.prototype={initialize:function(t){t=t||{};var e=this;this.EVENTS=r.EVENTS,this.dataStoring=[],this.totalItems=t.totalItems,this.pageItemsStorge=this.initItems(t.categoryData),this.loadedPages=[],this.page=1,delete t.totalItems,this.options=i.merge(this.options,t);var n=this.getPageSize();return this.options.connector.$getPage(this.page,n,function(t){var i=e.options,n=i.targetDOM;if(!t.length)return r.createErrorElement(i);e.loadedPages.push(e.page),e.addItemData(t,e.page);var o=new a(i),d=new s(i);e.lister=o,e.pager=d,e.onUploadedPage=function(t){e.addItemData(t,e.page),o.updateList(e.getItemData(e.page),e.page,i.item),d.updateState(e.page,e.totalItems)},o.sorter=e,n.appendChild(o.el),n.appendChild(d.el),o.onListUpdated=e.updateDataStoring.bind(e),d.onUploadPage=e.uploadPage.bind(e),o.updateList(e.getItemData(e.page),e.page,i.item),d.updateState(e.page,e.totalItems),n.$$instance=e},function(e){r.createErrorElement(t,e)}),this},getPageSize:function(){return+this.options.grid.cols*+this.options.grid.rows},addItemData:function(t,e){for(var i=this.getPageSize(),n=(e-1)*i,a=(this.getDataStoring(),0);a<t.length;a++)this.pageItemsStorge[n+a]=t[a]},getItemData:function(t){var e=this.getPageSize();(t*=1)<1&&(t=1);for(var i=(t-1)*e,n=[],a=0;a<e;a++)void 0!=this.pageItemsStorge[i+a]&&n.push(this.pageItemsStorge[i+a]);return n},options:t.NEKLO.ProductSorter.prototype.options,createErrorElement:t.NEKLO.ProductSorter.createErrorElement,getDataStoring:function(){return this.dataStoring},updateDataStoring:function(t){var e=this,n=this.getDataStoring(),a=[],s=this.getPageSize();this.page;i.forEach(t,function(t){var s=t.dataset?t.dataset:t;if(i.find(e.pageItemsStorge,function(t,e){return+t.entity_id==+s.entity_id&&(t.position=+s.position,t.attached=s.attached,t.isDirty=s.isDirty,!0)}),"true"===s.isDirty){var r=i.find(n,"entity_id",s.entity_id);r?r=Object.assign(r,s):n.push(s),a.push(s)}}),this.pageItemsStorge.sort(function(t,e){return t.position>e.position?1:e.position>t.position?-1:0}),this.emit&&this.emit(this.EVENTS.ON_ITEMS_CHANGED,a)},uploadData:function(t,e){var i=this,n=this.options,a=n.grid.cols,s=n.grid.rows,r=+a*+s;n.connector.$getPage(t,r,function(n){i.addItemData(n,t),i.loadedPages.push(t),e&&e()})},uploadPage:function(t,e){var i=this,n=this.options,a=n.grid.cols,s=n.grid.rows,r=+a*+s;this.loadedPages.indexOf(t)>-1?this.pageSkip?e&&e():(i.page=t,i.lister.updateList(i.getItemData(i.page),i.page,n.item),i.pager.updateState(i.page,i.totalItems)):n.connector.$getPage(t,r,function(n){i.page=t,i.loadedPages.push(i.page),i.onUploadedPage(n),e&&e()})},initItems:function(t){var e,i=[];return t.position.each(function(n){e={entity_id:n.key,position:n.value,attached:"1"==t.attached.get(n.key)},i.push(e)}),i.sort(function(t,e){return t.position>e.position?1:e.position>t.position?-1:0}),i},doSave:function(){var t=this.getDataStoring();return this.options.connector.$save(t)}},r.EVENTS=t.NEKLO.ProductSorter.EVENTS,t.NEKLO.ProductPager=t.NEKLO.SimpleEventEmitter?t.NEKLO.SimpleEventEmitter.mixin(r):t.NEKLO.ProductPager}(window,document,_),function(t,e,i){function n(n){var n=n||{},a={topId:"top_scroll_page",bottomId:"bottom_scroll_page",height:"20px"};n=i.extend(n,a);var s=e.createElement("div");s.setAttribute("id",n.topId),s.innerHTML="&nbsp;";var r=e.createElement("div");r.setAttribute("id",n.bottomId),r.innerHTML="&nbsp;";var o=e.querySelector("body"),d=[];d.push(s,r);var l,c,p={dragEnter:function(t){t.preventDefault&&t.preventDefault();this.getAttribute("id"),n.topId;return!1},dragOver:function(e){e.preventDefault&&e.preventDefault();var i=t.scrollY,a=this.getAttribute("id")===n.topId?-1:1,s=-1===a?l:c,r=-1===a?i:o.clientHeight-(i+t.screen.height);if(void 0!=s&&s==r&&r>0){var d=i+50*a;t.scrollTo(0,d)}return-1==a?l=r:c=r,!1},hide:function(t){return i.forEach(d,function(t){t.style.display="none"}),!0},show:function(t){return i.forEach(d,function(t){t.style.display="block"}),!0}};i.forEach(d,function(t){o.insertBefore(t,o.childNodes[0]),t.style.display="none",t.style.position="fixed",t.style.left="0px",t.style.right="0px",t.style.zIndex=99999,t.style.height=n.height,addEvent(t,"dragenter",p.dragEnter),addEvent(t,"dragover",p.dragOver),addEvent(t,"mouseover",p.hide)}),s.style.top="0px",r.style.bottom="0px",addEvent(e,"dragstart",p.show),addEvent(e,"dragend",p.hide)}t.dnd_page_scroll=n}(window,document,_);});